<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-gray-50">

    <div class="flex min-h-screen">

        <!-- SIDEBAR -->
        {% include "components/sidebar.html" %}

        <!-- MAIN CONTENT -->
        <main class="flex-1">

            <!-- Header -->
            <header class="bg-white shadow-sm px-8 py-4 flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-gray-800">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <div class="flex items-center gap-4">
                    <span class="text-sm text-gray-600">{{ user.email }}</span>
                    <div
                        class="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">
                        {{ user.first_name[0] if user.first_name else user.email[0]|upper }}
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="p-8">

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

                    <!-- –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="bg-white rounded-xl shadow-md p-6 fade-in">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-gray-600 text-sm font-medium">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                            <span class="text-3xl">üë•</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-800">{{ total_users }}</p>
                    </div>

                    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ -->
                    <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.1s">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-gray-600 text-sm font-medium">–ê–∫—Ç–∏–≤–Ω—ã–µ</h3>
                            <span class="text-3xl">‚úÖ</span>
                        </div>
                        <p class="text-3xl font-bold text-green-600">{{ active_users }}</p>
                    </div>

                    <!-- –û–∂–∏–¥–∞—é—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ -->
                    <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.2s">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-gray-600 text-sm font-medium">–û–∂–∏–¥–∞—é—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</h3>
                            <span class="text-3xl">‚è≥</span>
                        </div>
                        <p class="text-3xl font-bold text-orange-600">{{ pending_users }}</p>
                    </div>

                    <!-- ‚úÖ –î–ï–ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ù–´–ï -->
                    <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.3s">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-gray-600 text-sm font-medium">–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</h3>
                            <span class="text-3xl">‚è∏Ô∏è</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-600">{{ deactivated_users }}</p>
                    </div>

                    <!-- ‚úÖ –£–î–ê–õ–Å–ù–ù–´–ï -->
                    <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.3s">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-gray-600 text-sm font-medium">–£–¥–∞–ª—ë–Ω–Ω—ã–µ</h3>
                            <span class="text-3xl">üóëÔ∏è</span>
                        </div>
                        <p class="text-3xl font-bold text-red-600">{{ deleted_users }}</p>
                    </div>

                </div>

                <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6 fade-in" style="animation-delay: 0.3s">
                    <div class="flex flex-col md:flex-row gap-4 items-center justify-between">

                        <!-- –ü–æ–∏—Å–∫ -->
                        <form method="get" class="flex-1 w-full md:w-auto">
                            <input type="text" name="search" value="{{ search_query }}"
                                placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email..."
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </form>

                        <!-- –§–∏–ª—å—Ç—Ä—ã -->
                        <div class="flex gap-2 flex-wrap">
                            <a href="/admin/users?status=all"
                                class="px-4 py-2 rounded-lg text-sm {{ 'bg-indigo-600 text-white' if current_status == 'all' else 'bg-gray-200 text-gray-700 hover:bg-gray-300' }}">
                                üìã –í—Å–µ
                            </a>
                            <a href="/admin/users?status=active"
                                class="px-4 py-2 rounded-lg text-sm {{ 'bg-indigo-600 text-white' if current_status == 'active' else 'bg-gray-200 text-gray-700 hover:bg-gray-300' }}">
                                ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ
                            </a>
                            <a href="/admin/users?status=pending"
                                class="px-4 py-2 rounded-lg text-sm {{ 'bg-indigo-600 text-white' if current_status == 'pending' else 'bg-gray-200 text-gray-700 hover:bg-gray-300' }}">
                                ‚è≥ –û–∂–∏–¥–∞—é—Ç
                            </a>
                            <a href="/admin/users?status=deactivated"
                                class="px-4 py-2 rounded-lg text-sm {{ 'bg-indigo-600 text-white' if current_status == 'deactivated' else 'bg-gray-200 text-gray-700 hover:bg-gray-300' }}">
                                ‚è∏Ô∏è –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
                            </a>
                            <a href="/admin/users?status=deleted"
                                class="px-4 py-2 rounded-lg text-sm {{ 'bg-indigo-600 text-white' if current_status == 'deleted' else 'bg-gray-200 text-gray-700 hover:bg-gray-300' }}">
                                üóëÔ∏è –£–¥–∞–ª—ë–Ω–Ω—ã–µ
                            </a>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden fade-in" style="animation-delay: 0.4s">

                    {% if users %}
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–†–æ–ª—å
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–û—Ç–¥–µ–ª
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–°—Ç–∞—Ç—É—Å
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–î–∞—Ç–∞
                                        —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">
                                        –î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                {% for u in users %}
                                <tr class="hover:bg-gray-50 transition" id="user-row-{{ u.id }}">
                                    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold">
                                                {{ u.first_name[0] if u.first_name else u.email[0]|upper }}
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-800">
                                                    {{ u.first_name or '–ë–µ–∑ –∏–º–µ–Ω–∏' }} {{ u.last_name or '' }}
                                                </p>
                                                <p class="text-sm text-gray-500">{{ u.email }}</p>
                                            </div>
                                        </div>
                                    </td>

                                    <!-- –†–æ–ª—å -->
                                    <td class="px-6 py-4">
                                        <select onchange="changeRole({{ u.id }}, this.value)"
                                            class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            {{ 'disabled' if u.id==user.id else '' }}>
                                            <option value="employee" {{ 'selected' if u.role.value=='employee' else ''
                                                }}>üë§ –°–æ—Ç—Ä—É–¥–Ω–∏–∫</option>
                                            <option value="admin" {{ 'selected' if u.role.value=='admin' else '' }}>üëë
                                                –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                                            <option value="accountant" {{ 'selected' if u.role.value=='accountant'
                                                else '' }}>üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä</option>
                                            <option value="hr" {{ 'selected' if u.role.value=='hr' else '' }}>üëî HR
                                            </option>
                                            <option value="engineer" {{ 'selected' if u.role.value=='engineer' else ''
                                                }}>üîß –ò–Ω–∂–µ–Ω–µ—Ä</option>
                                            <option value="lawyer" {{ 'selected' if u.role.value=='lawyer' else '' }}>‚öñÔ∏è
                                                –Æ—Ä–∏—Å—Ç</option>
                                        </select>
                                    </td>

                                    <!-- –û—Ç–¥–µ–ª -->
                                    <td class="px-6 py-4">
                                        <span class="text-sm text-gray-600">{{ u.department_rel.name if u.department_rel else '‚Äî' }}</span>
                                    </td>

                                    <!-- –°—Ç–∞—Ç—É—Å -->
                                    <td class="px-6 py-4">
                                        {% if u.deleted_at %}
                                        <span
                                            class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">üóëÔ∏è
                                            –£–¥–∞–ª—ë–Ω</span>
                                        {% elif u.is_active %}
                                        <span
                                            class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">‚úÖ
                                            –ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% elif u.activated_at is none %}
                                        <span
                                            class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">‚è≥
                                            –û–∂–∏–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</span>
                                        {% else %}
                                        <span
                                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">‚è∏Ô∏è
                                            –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</span>
                                        {% endif %}
                                    </td>

                                    <!-- –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                                    <td class="px-6 py-4">
                                        <span class="text-sm text-gray-600">{{ u.created_at.strftime('%d.%m.%Y')
                                            }}</span>
                                    </td>

                                    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                                    <td class="px-6 py-4">
                                        <div class="flex gap-2 justify-end">

                                            {% if not u.deleted_at %}
                                            <!-- ‚úÖ –ö–ù–û–ü–ö–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ -->
                                            <button
                                                onclick="openEditModal({{ u.id }}, '{{ u.first_name or '' }}', '{{ u.last_name or '' }}', '{{ u.middle_name or '' }}', '{{ u.email }}', '{{ u.phone_number or '' }}', '{{ u.department_id or '' }}', '{{ u.position or '' }}', '{{ u.location or '' }}')"
                                                class="px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition"
                                                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                                <i class="bi bi-pencil"></i>
                                            </button>

                                            <!-- ‚úÖ –ö–ù–û–ü–ö–ê –°–ë–†–û–°–ò–¢–¨ –ü–ê–†–û–õ–¨ -->
                                            {% if u.id != user.id %}
                                            <button onclick="openPasswordResetModal({{ u.id }}, '{{ u.email }}')"
                                                class="px-3 py-1 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700 transition"
                                                title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å">
                                                <i class="bi bi-key"></i>
                                            </button>
                                            {% endif %}

                                            <!-- –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å -->
                                            {% if u.id != user.id %}
                                            {% if u.is_active %}
                                            <button onclick="deactivateUser({{ u.id }})"
                                                class="px-3 py-1 bg-orange-600 text-white text-sm rounded-lg hover:bg-orange-700 transition"
                                                title="–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å">
                                                <i class="bi bi-pause-circle"></i>
                                            </button>
                                            {% else %}
                                            <button onclick="activateUser({{ u.id }})"
                                                class="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition"
                                                title="–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å">
                                                <i class="bi bi-check-circle"></i>
                                            </button>
                                            {% endif %}

                                            <!-- –£–¥–∞–ª–∏—Ç—å -->
                                            <button onclick="deleteUser({{ u.id }}, '{{ u.email }}')"
                                                class="px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition"
                                                title="–£–¥–∞–ª–∏—Ç—å">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                            {% else %}
                                            <span class="text-xs text-gray-400">–≠—Ç–æ –≤—ã</span>
                                            {% endif %}
                                            {% else %}
                                            <span class="text-xs text-gray-400">–£–¥–∞–ª—ë–Ω {{
                                                u.deleted_at.strftime('%d.%m.%Y') }}</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-12 text-gray-500">
                        <span class="text-6xl mb-4 block">üë•</span>
                        <p class="text-xl">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                    </div>
                    {% endif %}

                </div>

            </div>

        </main>

    </div>

    <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <!-- Header -->
            <div class="bg-indigo-600 text-white px-6 py-4 flex justify-between items-center rounded-t-xl">
                <h3 class="text-xl font-semibold">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <button onclick="closeEditModal()" class="text-white hover:text-gray-200 text-2xl">&times;</button>
            </div>

            <!-- Form -->
            <form id="editUserForm" class="p-6 space-y-4">
                <input type="hidden" id="edit_user_id">

                <!-- –§–ò–û -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è</label>
                        <input type="text" id="edit_first_name"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="edit_last_name"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" id="edit_middle_name"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>

                <!-- Email -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="edit_email" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="edit_phone_number" placeholder="+7 (999) 999-99-99"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <!-- –û—Ç–¥–µ–ª –∏ –î–æ–ª–∂–Ω–æ—Å—Ç—å -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–û—Ç–¥–µ–ª</label>
                        <select id="edit_department_id"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                            {% for dept in departments %}
                            <option value="{{ dept.id }}">{{ dept.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                        <input type="text" id="edit_position"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>

                <!-- –õ–æ–∫–∞—Ü–∏—è -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</label>
                    <input type="text" id="edit_location" placeholder="–ú–æ—Å–∫–≤–∞, –æ—Ñ–∏—Å 1"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="flex gap-3 pt-4">
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button type="button" onclick="closeEditModal()"
                        class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-medium">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–ë–†–û–°–ê –ü–ê–†–û–õ–Ø -->
    <div id="passwordResetModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <!-- Header -->
            <div class="bg-purple-600 text-white px-6 py-4 flex justify-between items-center rounded-t-xl">
                <h3 class="text-xl font-semibold">üîë –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</h3>
                <button onclick="closePasswordResetModal()"
                    class="text-white hover:text-gray-200 text-2xl">&times;</button>
            </div>

            <!-- Form -->
            <form id="passwordResetForm" class="p-6 space-y-4">
                <input type="hidden" id="reset_user_id">
                <input type="hidden" id="reset_user_email">

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è:</p>
                    <p class="text-lg font-semibold text-gray-800" id="reset_user_email_display"></p>
                </div>

                <!-- –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="reset_new_password" required minlength="6"
                        placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="reset_confirm_password" required minlength="6"
                        placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                    <p class="text-sm text-yellow-800">
                        ‚ö†Ô∏è –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –∑–∞–≤–µ—Ä—à–µ–Ω—ã
                    </p>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="flex gap-3 pt-4">
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-medium">
                        üîë –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
                    </button>
                    <button type="button" onclick="closePasswordResetModal()"
                        class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-medium">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        console.log('‚úÖ Admin users page JS loaded');

        // ===================================
        // –ê–ö–¢–ò–í–ê–¶–ò–Ø/–î–ï–ê–ö–¢–ò–í–ê–¶–ò–Ø
        // ===================================
        async function activateUser(userId) {
            console.log('üîµ activateUser called with userId:', userId);

            if (!confirm('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                console.log('‚ùå User cancelled activation');
                return;
            }

            try {
                console.log('üì° Sending POST to /admin/users/' + userId + '/activate');

                const response = await fetch(`/admin/users/${userId}/activate`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('üì• Response status:', response.status);

                const data = await response.json();
                console.log('üì• Response data:', data);

                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            }
        }

        async function deactivateUser(userId) {
            console.log('üî¥ deactivateUser called with userId:', userId);

            if (!confirm('–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                console.log('‚ùå User cancelled deactivation');
                return;
            }

            try {
                console.log('üì° Sending POST to /admin/users/' + userId + '/deactivate');

                const response = await fetch(`/admin/users/${userId}/deactivate`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('üì• Response status:', response.status);

                const data = await response.json();
                console.log('üì• Response data:', data);

                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            }
        }

        // ===================================
        // –ò–ó–ú–ï–ù–ï–ù–ò–ï –†–û–õ–ò
        // ===================================
        async function changeRole(userId, newRole) {
            console.log('üü° changeRole called with userId:', userId, 'newRole:', newRole);

            if (!confirm(`–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ "${newRole}"?`)) {
                console.log('‚ùå User cancelled role change');
                location.reload();
                return;
            }

            try {
                console.log('üì° Sending POST to /admin/users/' + userId + '/role');

                const formData = new FormData();
                formData.append('role', newRole);

                const response = await fetch(`/admin/users/${userId}/role`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                console.log('üì• Response status:', response.status);

                const data = await response.json();
                console.log('üì• Response data:', data);

                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                    location.reload();
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
                location.reload();
            }
        }

        // ===================================
        // –£–î–ê–õ–ï–ù–ò–ï
        // ===================================
        async function deleteUser(userId, email) {
            console.log('üî¥ deleteUser called with userId:', userId, 'email:', email);

            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${email}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
                console.log('‚ùå User cancelled deletion');
                return;
            }

            try {
                console.log('üì° Sending DELETE to /admin/users/' + userId);

                const response = await fetch(`/admin/users/${userId}`, {
                    method: 'DELETE',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('üì• Response status:', response.status);

                const data = await response.json();
                console.log('üì• Response data:', data);

                if (data.success) {
                    alert(data.message);
                    const row = document.getElementById(`user-row-${userId}`);
                    if (row) row.remove();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            }
        }

        // ===================================
        // –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï
        // ===================================
        function openEditModal(userId, firstName, lastName, middleName, email, phone, departmentId, position, location) {
            console.log('üîµ openEditModal called', { userId, firstName, lastName, email });

            document.getElementById('edit_user_id').value = userId;
            document.getElementById('edit_first_name').value = firstName || '';
            document.getElementById('edit_last_name').value = lastName || '';
            document.getElementById('edit_middle_name').value = middleName || '';
            document.getElementById('edit_email').value = email || '';
            document.getElementById('edit_phone_number').value = phone || '';
            document.getElementById('edit_department_id').value = departmentId || '';
            document.getElementById('edit_position').value = position || '';
            document.getElementById('edit_location').value = location || '';

            document.getElementById('editModal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editUserForm').reset();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('editUserForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const userId = document.getElementById('edit_user_id').value;

            console.log('üì° Sending edit request for user:', userId);

            try {
                const formData = new FormData();
                formData.append('first_name', document.getElementById('edit_first_name').value);
                formData.append('last_name', document.getElementById('edit_last_name').value);
                formData.append('middle_name', document.getElementById('edit_middle_name').value);
                formData.append('email', document.getElementById('edit_email').value);
                formData.append('phone_number', document.getElementById('edit_phone_number').value);
                formData.append('department_id', document.getElementById('edit_department_id').value);
                formData.append('position', document.getElementById('edit_position').value);
                formData.append('location', document.getElementById('edit_location').value);

                const response = await fetch(`/admin/users/${userId}/edit`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                const data = await response.json();
                console.log('üì• Response:', data);

                if (data.success) {
                    alert(data.message);
                    closeEditModal();
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('editModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // ===================================
        // –ê–í–¢–û–ü–û–ò–°–ö
        // ===================================
        const searchInput = document.querySelector('input[name="search"]');
        if (searchInput) {
            searchInput.addEventListener('input', function (e) {
                clearTimeout(this.searchTimeout);
                this.searchTimeout = setTimeout(() => {
                    this.form.submit();
                }, 500);
            });
        }

        console.log('‚úÖ All admin functions loaded');
    </script>

    <script>
        // ===================================
        // –°–ë–†–û–° –ü–ê–†–û–õ–Ø
        // ===================================
        function openPasswordResetModal(userId, email) {
            console.log('üîë openPasswordResetModal called', { userId, email });

            document.getElementById('reset_user_id').value = userId;
            document.getElementById('reset_user_email').value = email;
            document.getElementById('reset_user_email_display').textContent = email;
            document.getElementById('reset_new_password').value = '';
            document.getElementById('reset_confirm_password').value = '';

            document.getElementById('passwordResetModal').classList.remove('hidden');
        }

        function closePasswordResetModal() {
            document.getElementById('passwordResetModal').classList.add('hidden');
            document.getElementById('passwordResetForm').reset();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
        document.getElementById('passwordResetForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const userId = document.getElementById('reset_user_id').value;
            const email = document.getElementById('reset_user_email').value;
            const newPassword = document.getElementById('reset_new_password').value;
            const confirmPassword = document.getElementById('reset_confirm_password').value;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (newPassword !== confirmPassword) {
                alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                return;
            }

            if (newPassword.length < 6) {
                alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }

            console.log('üì° Sending password reset for user:', userId);

            try {
                const formData = new FormData();
                formData.append('new_password', newPassword);

                const response = await fetch(`/admin/users/${userId}/reset-password`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                const data = await response.json();
                console.log('üì• Response:', data);

                if (data.success) {
                    alert(data.message);
                    closePasswordResetModal();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('passwordResetModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closePasswordResetModal();
            }
        });

        console.log('‚úÖ Password reset functions loaded');
    </script>

</body>

</html>