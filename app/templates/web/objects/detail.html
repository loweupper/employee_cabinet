<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>{{ object.title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .word-break {
            word-break: break-word;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –º–æ–¥–∞–ª–∫–∏ –∏ –¥–µ–ª–∞–µ–º –µ—ë –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π */
        #uploadDocModal .bg-white {
            max-width: 50vw;
            max-height: 90vh;
        }
    </style>
</head>

<body class="bg-gray-50">

    <div class="flex min-h-screen">

        <!-- ========== SIDEBAR ========== -->
        {% include "components/sidebar.html" %}
        <!-- ========== MAIN CONTENT ========== -->
        <main class="flex-1">

            <!-- Header -->
            <header class="bg-white shadow-sm px-8 py-4 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <a href="/objects" class="text-gray-600 hover:text-gray-800">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
                    <h2 class="text-2xl font-semibold text-gray-800">{{ object.title }}</h2>


                    <!-- ‚úÖ –ë–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ -->
                    {% if object.is_archived %}
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full">üì¶ –í –∞—Ä—Ö–∏–≤–µ</span>
                    {% elif not object.is_active %}
                    <span class="px-3 py-1 bg-yellow-100 text-yellow-700 text-sm rounded-full">‚è∏Ô∏è –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                    {% endif %}
                </div>
                <div class="flex items-center gap-4">
                    <!-- ‚úÖ –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö, –∫—Ä–æ–º–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞/–∞–¥–º–∏–Ω–∞) -->
                    {% if (object.created_by == user.id or user.role == "admin") and not object.is_archived %}
                    <a href="/objects/{{ object.id }}/edit"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>

                    <form method="post" action="/objects/{{ object.id }}/delete"
                        onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç?');"
                        style="display: inline;">
                        <button type="submit"
                            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                    {% endif %}

                    {% if object.is_archived %}
                    <span class="text-sm text-gray-500 italic">–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
                    {% endif %}

                    <span class="text-sm text-gray-600">{{ user.email }}</span>
                    <div
                        class="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">
                        {{ user.first_name[0] if user.first_name else user.email[0]|upper }}
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="p-8">

                <!-- Success/Error messages -->
                {% if success %}
                <div class="bg-green-50 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-lg fade-in">
                    <p class="font-semibold">‚úì {{ success }}</p>
                </div>
                {% endif %}

                {% if error %}
                <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-lg fade-in">
                    <p class="font-semibold">‚úó {{ error }}</p>
                </div>
                {% endif %}

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    <!-- ========== –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ ========== -->
                    <div class="lg:col-span-2 space-y-6">

                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden fade-in">

                            <!-- –ò–∫–æ–Ω–∫–∞ -->
                            <div
                                class="h-64 bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                                {% if object.icon_url %}
                                <img src="{{ object.icon_url }}" alt="{{ object.title }}"
                                    class="w-full h-full object-cover">
                                {% else %}
                                <span class="text-8xl text-white">üèóÔ∏è</span>
                                {% endif %}
                            </div>

                            <!-- –î–µ—Ç–∞–ª–∏ -->
                            <div class="p-6">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">{{ object.title }}</h3>

                                {% if object.address %}
                                <div class="flex items-start gap-3 mb-3">
                                    <span class="text-gray-500">üìç</span>
                                    <div>
                                        <p class="text-sm text-gray-500">–ê–¥—Ä–µ—Å</p>
                                        <p class="text-gray-800">{{ object.address }}</p>
                                    </div>
                                </div>
                                {% endif %}

                                {% if object.description %}
                                <div class="flex items-start gap-3 mb-3">
                                    <span class="text-gray-500">üìù</span>
                                    <div>
                                        <p class="text-sm text-gray-500">–û–ø–∏—Å–∞–Ω–∏–µ</p>
                                        <p class="text-gray-800">{{ object.description }}</p>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã -->

                                <div class="flex gap-2 mt-4">
                                    {% if object.department %}
                                    <span class="px-3 py-1 bg-indigo-100 text-indigo-700 text-sm rounded-full">{{
                                        object.department }}</span>
                                    {% endif %}

                                    {% if object.location %}
                                    <span class="px-3 py-1 bg-green-100 text-green-700 text-sm rounded-full">{{
                                        object.location }}</span>
                                    {% endif %}

                                    <!-- –°—Ç–∞—Ç—É—Å—ã -->
                                    {% if object.deleted_at %}
                                    <span class="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">üóëÔ∏è
                                        –£–¥–∞–ª–µ–Ω</span>
                                    {% elif object.is_archived %}
                                    <span class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full">üì¶ –í
                                        –∞—Ä—Ö–∏–≤–µ</span>
                                    {% elif object.is_active %}
                                    <span class="px-3 py-1 bg-green-100 text-green-700 text-sm rounded-full">‚úì
                                        –ê–∫—Ç–∏–≤–µ–Ω</span>
                                    {% else %}
                                    <span class="px-3 py-1 bg-yellow-100 text-yellow-700 text-sm rounded-full">‚è∏Ô∏è
                                        –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                                    {% endif %}
                                    {% if object.id %}
                                    <p class="px-3 py-1 bg-green-100 text-red-700 text-sm rounded-full">üÜî ID: {{ object.id }}</p>
                                    {% endif %}

                                </div>

                                <!-- ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞/–∞–¥–º–∏–Ω–∞) -->
                                {% if object.created_by == user.id or user.role == "admin" %}
                                <div class="mt-6 pt-6 border-t">
                                    <h5 class="text-sm font-semibold text-gray-800 mb-3">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º</h5>
                                    <div class="flex gap-2 flex-wrap">

                                        {% if not object.is_active %}
                                        <form method="post" action="/objects/{{ object.id }}/activate"
                                            style="display:inline;">
                                            <button type="submit"
                                                class="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition">
                                                ‚ñ∂Ô∏è –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                                            </button>
                                        </form>
                                        {% endif %}

                                        {% if object.is_active %}
                                        <form method="post" action="/objects/{{ object.id }}/deactivate"
                                            style="display:inline;">
                                            <button type="submit"
                                                class="px-3 py-1 bg-yellow-600 text-white text-sm rounded-lg hover:bg-yellow-700 transition">
                                                ‚è∏Ô∏è –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                                            </button>
                                        </form>
                                        {% endif %}

                                        {% if not object.is_archived %}
                                        <form method="post" action="/objects/{{ object.id }}/archive"
                                            onsubmit="return confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç –≤ –∞—Ä—Ö–∏–≤?');"
                                            style="display:inline;">
                                            <button type="submit"
                                                class="px-3 py-1 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700 transition">
                                                üì¶ –í –∞—Ä—Ö–∏–≤
                                            </button>
                                        </form>
                                        {% else %}
                                        <form method="post" action="/objects/{{ object.id }}/unarchive"
                                            style="display:inline;">
                                            <button type="submit"
                                                class="px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition">
                                                üì§ –ò–∑ –∞—Ä—Ö–∏–≤–∞
                                            </button>
                                        </form>
                                        {% endif %}

                                    </div>
                                </div>
                                {% endif %}
                            </div>

                        </div>

                        <!-- ‚úÖ –ú–ê–ö–†–û–° –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –î–û–ö–£–ú–ï–ù–¢–ê -->
                        {% macro render_document_item(doc, object, user) %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition document-item"
                            data-category="{{ doc.category.value }}">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <!-- –ò–∫–æ–Ω–∫–∞ —Ñ–∞–π–ª–∞ -->
                                <div
                                    class="w-10 h-10 bg-gray-50 rounded-lg flex items-center justify-center flex-shrink-0">
                                    {% if doc.file_type and 'pdf' in doc.file_type %}
                                    <i class="bi bi-file-earmark-pdf text-3xl text-red-600"></i>
                                    {% elif doc.file_type and 'image' in doc.file_type %}
                                    <i class="bi bi-file-earmark-image text-3xl text-blue-600"></i>
                                    {% elif doc.file_type and 'excel' in doc.file_type or 'spreadsheet' in doc.file_type
                                    %}
                                    <i class="bi bi-file-earmark-excel text-3xl text-green-600"></i>
                                    {% elif doc.file_type and 'word' in doc.file_type or 'document' in doc.file_type %}
                                    <i class="bi bi-file-earmark-word text-3xl text-blue-700"></i>
                                    {% else %}
                                    <i class="bi bi-file-earmark text-3xl text-gray-600"></i>
                                    {% endif %}
                                </div>

                                <div class="flex-1 min-w-0">
                                    <p class="font-medium text-gray-800 break-words">{{ doc.title }}</p>
                                    <div class="flex items-center gap-2 text-xs text-gray-500 flex-wrap">
                                        <span>{{ doc.file_name }}</span>
                                        <span>‚Ä¢</span>
                                        <span>{{ (doc.file_size / 1024 / 1024)|round(2) }} –ú–ë</span>
                                        <span title="–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏">üìÖ {{ doc.created_at.strftime('%d.%m.%Y %H:%M')
                                            }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                            <div class="flex gap-2 ml-4 flex-shrink-0">
                                <a href="/documents/{{ doc.id }}/download"
                                    class="px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition whitespace-nowrap">
                                    ‚¨á
                                </a>

                                {% if object.created_by == user.id or user.role == "admin" %}
                                <button
                                    onclick="openEditDocumentModal({{ doc.id }}, '{{ doc.title }}', '{{ doc.category.value }}', {{ doc.subcategory_id or 'null' }})"
                                    class="px-3 py-1 bg-yellow-600 text-white text-sm rounded-lg hover:bg-yellow-700 transition whitespace-nowrap">
                                    ‚úèÔ∏è
                                </button>

                                <button onclick="deleteDocument({{ object.id }}, {{ doc.id }}, '{{ doc.file_name }}')"
                                    class="px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition whitespace-nowrap">
                                    üóëÔ∏è
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        {% endmacro %}

                        <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã -->
                        <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.1s">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-800">üìÅ –î–æ–∫—É–º–µ–Ω—Ç—ã –æ–±—ä–µ–∫—Ç–∞</h4>

                                <!-- ‚úÖ –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
                                {% if not object.is_archived %}
                                <button onclick="openUploadModal()"
                                    class="px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition">
                                    ‚ûï –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
                                </button>
                                {% endif %}
                            </div>

                            <!-- ‚úÖ –¢–ê–ë–´ –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú -->
                            <div class="mb-4">
                                <div class="flex gap-2 overflow-x-auto pb-2">
                                    <button onclick="showCategory('all')"
                                        class="category-tab px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition whitespace-nowrap"
                                        data-category="all">
                                        üìã –í—Å–µ
                                    </button>
                                    <button onclick="showCategory('general')"
                                        class="category-tab px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition whitespace-nowrap"
                                        data-category="general">
                                        üìã –û–±—â–∏–µ
                                    </button>
                                    <button onclick="showCategory('technical')"
                                        class="category-tab px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition whitespace-nowrap"
                                        data-category="technical">
                                        üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
                                    </button>
                                    <button onclick="showCategory('accounting')"
                                        class="category-tab px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition whitespace-nowrap"
                                        data-category="accounting">
                                        üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è
                                    </button>
                                    <button onclick="showCategory('safety')"
                                        class="category-tab px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition whitespace-nowrap"
                                        data-category="safety">
                                        üë∑ –û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞
                                    </button>
                                    <button onclick="showCategory('legal')"
                                        class="category-tab px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition whitespace-nowrap"
                                        data-category="legal">
                                        ‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ
                                    </button>
                                    <button onclick="showCategory('hr')"
                                        class="category-tab px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition whitespace-nowrap"
                                        data-category="hr">
                                        üëî –ö–∞–¥—Ä–æ–≤—ã–µ
                                    </button>
                                </div>
                            </div>

                            <!-- ‚úÖ –°–ü–ò–°–û–ö –î–û–ö–£–ú–ï–ù–¢–û–í –° –ü–û–î–ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò -->
                            {% if documents %}
                            <div class="space-y-4" id="documentsContainer">
                                {% for category, category_data in documents_by_category.items() %}
                                <div class="category-section" data-category="{{ category.value }}">

                                    <!-- ‚úÖ –ó–ê–ì–û–õ–û–í–û–ö –ö–ê–¢–ï–ì–û–†–ò–ò -->
                                    <h5 class="text-md font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                        {% if category.value == 'general' %}üìã –û–±—â–∏–µ
                                        {% elif category.value == 'technical' %}üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
                                        {% elif category.value == 'accounting' %}üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è
                                        {% elif category.value == 'safety' %}üë∑ –û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞
                                        {% elif category.value == 'legal' %}‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ
                                        {% elif category.value == 'hr' %}üëî –ö–∞–¥—Ä–æ–≤—ã–µ
                                        {% endif %}
                                        <span class="text-xs text-gray-500">({{ category_data.docs|length }})</span>
                                    </h5>

                                    <!-- ‚úÖ –ü–û–î–ö–ê–¢–ï–ì–û–†–ò–ò -->
                                    {% for subcategory_id, subcat_docs in category_data.by_subcat %}
                                    {% if subcategory_id != 0 %}
                                    {% set subcat = subcat_docs[0].subcategory_ref %}

                                    <!-- –ê–ö–ö–û–†–î–ï–û–ù –ü–û–î–ö–ê–¢–ï–ì–û–†–ò–ò -->
                                    <div class="mb-3 border border-gray-200 rounded-lg overflow-hidden">
                                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                                        <div class="bg-gray-50 p-3 flex justify-between items-center cursor-pointer hover:bg-gray-100 transition"
                                            onclick="toggleSubcategoryAccordion({{ subcategory_id }})">
                                            <div class="flex items-center gap-2">
                                                <span id="subcategory-toggle-{{ subcategory_id }}"
                                                    class="text-gray-600">‚ñº</span>
                                                <span class="font-medium text-gray-800">üìÅ {{ subcat.name }}</span>
                                                <span class="text-xs text-gray-500">({{ subcat_docs|length }}
                                                    —Ñ–∞–π–ª–æ–≤)</span>
                                            </div>

                                            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π -->
                                            {% if object.created_by == user.id or user.role == "admin" %}
                                            <div class="flex gap-2" onclick="event.stopPropagation()">
                                                <button
                                                    onclick="openEditSubcategoryModal({{ object.id }}, {{ subcategory_id }}, '{{ subcat.name }}', '{{ subcat.description or '' }}')"
                                                    class="text-xs px-2 py-1 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200">
                                                    ‚úèÔ∏è
                                                </button>
                                                <button
                                                    onclick="deleteSubcategory({{ object.id }}, {{ subcategory_id }}, '{{ subcat.name }}')"
                                                    class="text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                            {% endif %}
                                        </div>

                                        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ñ–∞–π–ª—ã) -->
                                        <div id="subcategory-content-{{ subcategory_id }}"
                                            class="p-3 space-y-2 bg-white">
                                            {% for doc in subcat_docs %}
                                            {{ render_document_item(doc, object, user) }}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% else %}
                                    <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã –ë–ï–ó –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                                    <div class="space-y-2 mb-3">
                                        {% for doc in subcat_docs %}
                                        {{ render_document_item(doc, object, user) }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    {% endfor %}

                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="text-center py-8 text-gray-500">
                                <span class="text-4xl mb-2 block">üìÑ</span>
                                <p>–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                        <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
                        <div id="editDocumentModal"
                            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full mx-4">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h3>
                                    <button onclick="closeEditDocumentModal()"
                                        class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                                </div>

                                <form id="editDocumentForm" method="post" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                                        <input type="text" id="editDocTitle" name="title" required
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                    </div>

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–†–∞–∑–¥–µ–ª *</label>
                                        <select id="editDocCategory" name="category" required
                                            onchange="updateEditSubcategories()"
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                            <option value="general">üìã –û–±—â–∏–µ</option>
                                            <option value="technical">üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</option>
                                            <option value="accounting">üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</option>
                                            <option value="safety">üë∑ –û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞</option>
                                            <option value="legal">‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ</option>
                                            <option value="hr">üëî –ö–∞–¥—Ä–æ–≤—ã–µ</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                        <select id="editDocSubcategory" name="subcategory_id"
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                            <option value="">–ë–µ–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                        </select>
                                    </div>

                                    <div class="flex gap-4 pt-4">
                                        <button type="submit"
                                            class="flex-1 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                            ‚úì –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                        </button>
                                        <button type="button" onclick="closeEditDocumentModal()"
                                            class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                            –û—Ç–º–µ–Ω–∞
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (—Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π) -->
                        <div id="uploadDocModal"
                            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div
                                class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-xl font-bold text-gray-800">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</h3>
                                    <button onclick="closeUploadModal()"
                                        class="text-gray-500 hover:text-gray-700 text-2xl">
                                        √ó
                                    </button>
                                </div>

                                <div class="space-y-4">
                                    <!-- –†–∞–∑–¥–µ–ª -->
                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–†–∞–∑–¥–µ–ª *</label>
                                        <select id="uploadCategory" required onchange="updateSubcategories()"
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</option>
                                            <option value="general">üìã –û–±—â–∏–µ (–¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º)</option>
                                            <option value="technical">üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</option>
                                            <option value="accounting">üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</option>
                                            <option value="safety">üë∑ –û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞</option>
                                            <option value="legal">‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ</option>
                                            <option value="hr">üëî –ö–∞–¥—Ä–æ–≤—ã–µ</option>
                                        </select>
                                    </div>

                                    <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è -->
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <label class="block text-gray-700 font-medium">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                            <button type="button" onclick="openCreateSubcategoryModal()"
                                                class="text-xs text-indigo-600 hover:text-indigo-700">
                                                ‚ûï –ù–æ–≤–∞—è
                                            </button>
                                        </div>
                                        <select id="uploadSubcategory"
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                            <option value="">–ë–µ–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                        </select>
                                    </div>

                                    <!-- –í—ã–±–æ—Ä —Ñ–∞–π–ª–æ–≤ (—Å–∫—Ä—ã—Ç—ã–π input) -->
                                    <input type="file" id="fileInput" multiple
                                        accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg" class="hidden">

                                    <!-- –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã</label>
                                        <div id="dropZone"
                                            class="border-2 border-dashed border-indigo-300 rounded-lg p-6 text-center cursor-pointer hover:bg-indigo-50 transition">
                                            <div class="text-4xl mb-2">üìÅ</div>
                                            <p class="text-gray-700 font-medium">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã</p>
                                            <p class="text-xs text-gray-500 mt-1">
                                                PDF, DOCX, XLSX, PNG, JPG (–º–∞–∫—Å. 50 –ú–ë –∫–∞–∂–¥—ã–π)
                                            </p>
                                        </div>
                                    </div>

                                    <!-- ‚úÖ –°–ü–ò–°–û–ö –ó–ê–ì–†–£–ñ–ï–ù–ù–´–• –§–ê–ô–õ–û–í -->
                                    <div id="uploadedFilesList" class="hidden">
                                        <label class="block text-gray-700 font-medium mb-2">üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ
                                            —Ñ–∞–π–ª—ã</label>
                                        <div id="uploadedFilesPreview"
                                            class="space-y-2 bg-green-50 p-4 rounded-lg border border-green-200">
                                        </div>
                                    </div>

                                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
                                    <div id="uploadProgress" class="hidden">
                                        <div class="flex items-center gap-2">
                                            <div class="animate-spin">‚è≥</div>
                                            <p class="text-sm text-gray-700" id="progressText">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...
                                            </p>
                                        </div>
                                    </div>

                                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                                    <div class="flex gap-4 pt-4">
                                        <button type="button" onclick="openFileDialog()"
                                            class="flex-1 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã
                                        </button>
                                        <button type="button" onclick="closeUploadModal()"
                                            class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                            ‚úì –ì–æ—Ç–æ–≤–æ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div id="createSubcategoryModal"
                            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full mx-4">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-xl font-bold text-gray-800">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                                    <button
                                        onclick="document.getElementById('createSubcategoryModal').classList.add('hidden')"
                                        class="text-gray-500 hover:text-gray-700 text-2xl">
                                        √ó
                                    </button>
                                </div>

                                <form method="post" action="/objects/{{ object.id }}/subcategories/create"
                                    class="space-y-4">

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                                            *</label>
                                        <input type="text" name="name" required
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"
                                            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£–ü–î, –°—á–µ—Ç–∞-—Ñ–∞–∫—Ç—É—Ä—ã, –ß–µ—Ä—Ç–µ–∂–∏">
                                    </div>

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                        <textarea name="description" rows="2"
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"
                                            placeholder="–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea>
                                    </div>

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–†–∞–∑–¥–µ–ª *</label>
                                        <input type="hidden" name="category" id="subcatCategory" value="">
                                        <div id="subcatCategoryDisplay"
                                            class="px-4 py-2 rounded-lg border border-gray-300 bg-gray-50 text-gray-700">
                                            –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –≤ —Ñ–æ—Ä–º–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã—à–µ
                                        </div>
                                    </div>

                                    <div class="flex gap-4 pt-4">
                                        <button type="submit"
                                            class="flex-1 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                            ‚úì –°–æ–∑–¥–∞—Ç—å
                                        </button>
                                        <button type="button"
                                            onclick="document.getElementById('createSubcategoryModal').classList.add('hidden')"
                                            class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                            –û—Ç–º–µ–Ω–∞
                                        </button>
                                    </div>

                                </form>
                            </div>
                        </div>

                        <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div id="editSubcategoryModal"
                            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full mx-4">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                                    <button onclick="closeEditSubcategoryModal()"
                                        class="text-gray-500 hover:text-gray-700 text-2xl">
                                        √ó
                                    </button>
                                </div>

                                <form id="editSubcategoryForm" method="post" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                                        <input type="text" id="editSubcatName" name="name" required
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                    </div>

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                        <textarea id="editSubcatDesc" name="description" rows="2"
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500"></textarea>
                                    </div>

                                    <div class="flex gap-4 pt-4">
                                        <button type="submit"
                                            class="flex-1 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                            ‚úì –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                        </button>
                                        <button type="button" onclick="closeEditSubcategoryModal()"
                                            class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                            –û—Ç–º–µ–Ω–∞
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>



                    </div>

                    <!-- ========== –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –¥–æ—Å—Ç—É–ø—ã ========== -->
                    <div class="space-y-6">

                        <!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
                        <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.2s">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">üë§ –í–ª–∞–¥–µ–ª–µ—Ü</h4>
                            <div class="flex items-center gap-3">
                                {% if object.owner.avatar_url %}
                                <img src="{{ object.owner.avatar_url }}" alt="{{ object.owner.email }}"
                                    class="w-12 h-12 rounded-full">
                                {% else %}
                                <div
                                    class="w-12 h-12 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">
                                    {{ object.owner.first_name[0] if object.owner.first_name else
                                    object.owner.email[0]|upper }}
                                </div>
                                {% endif %}
                                <div>
                                    <p class="font-medium text-gray-800">
                                        {{ object.owner.first_name }} {{ object.owner.last_name if
                                        object.owner.last_name else '' }}
                                    </p>
                                    <p class="text-sm text-gray-500">{{ object.owner.email }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º -->
                        <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.3s">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-800">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ ({{ accesses|length
                                    }})
                                </h4>

                                {% if object.created_by == user.id or user.role == "admin" %}
                                <button onclick="document.getElementById('addUserModal').classList.remove('hidden')"
                                    class="text-indigo-600 hover:text-indigo-700 text-sm font-medium">
                                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                                </button>
                                {% endif %}
                            </div>

                            {% if accesses %}
                            <div class="space-y-3">
                                {% for access in accesses %}
                                <div
                                    class="flex items-start justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="flex items-start gap-3 flex-1">
                                        <!-- –ê–≤–∞—Ç–∞—Ä -->
                                        {% if access.user.avatar_url %}
                                        <img src="{{ access.user.avatar_url }}" alt="{{ access.user.email }}"
                                            class="w-12 h-12 rounded-full">
                                        {% else %}
                                        <div
                                            class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center text-sm font-bold text-indigo-600">
                                            {{ access.user.first_name[0] if access.user.first_name else
                                            access.user.email[0]|upper }}
                                        </div>
                                        {% endif %}

                                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-800">
                                                {{ access.user.first_name or access.user.email }}
                                                {% if access.user.last_name %}{{ access.user.last_name }}{% endif %}
                                            </p>
                                            <p class="text-xs text-gray-500">{{ access.user.email }}</p>

                                            <!-- –†–æ–ª—å -->
                                            <div class="mt-2">
                                                <span class="inline-block px-2 py-1 text-xs rounded-full
                            {% if access.role.value == 'owner' %}bg-purple-100 text-purple-700
                            {% elif access.role.value == 'admin' %}bg-red-100 text-red-700
                            {% elif access.role.value == 'editor' %}bg-blue-100 text-blue-700
                            {% else %}bg-gray-100 text-gray-700
                            {% endif %}">
                                                    {% if access.role.value == 'owner' %}üëë –í–ª–∞–¥–µ–ª–µ—Ü
                                                    {% elif access.role.value == 'admin' %}üõ°Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                                                    {% elif access.role.value == 'editor' %}‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä
                                                    {% else %}üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                                                    {% endif %}
                                                </span>
                                            </div>

                                            <!-- ‚úÖ –ù–û–í–û–ï: –†–∞–∑–¥–µ–ª—ã –¥–æ—Å—Ç—É–ø–∞ -->
                                            <div class="mt-2 flex flex-wrap gap-1">
                                                <div class="text-xs text-gray-400 mr-1">–†–∞–∑–¥–µ–ª—ã –¥–æ—Å—Ç—É–ø–∞:</div>
                                                {% if access.sections_access %}
                                                {% for section in access.sections_access %}
                                                <span class="inline-block px-2 py-0.5 text-xs rounded-full
                                {% if section == 'general' %}bg-gray-100 text-gray-600
                                {% elif section == 'technical' %}bg-blue-100 text-blue-600
                                {% elif section == 'accounting' %}bg-green-100 text-green-600
                                {% elif section == 'safety' %}bg-yellow-100 text-yellow-600
                                {% elif section == 'legal' %}bg-purple-100 text-purple-600
                                {% elif section == 'hr' %}bg-pink-100 text-pink-600
                                {% endif %}">
                                                    {% if section == 'general' %} <span title="–û–±—â–∏–µ">üìã</span>
                                                    {% elif section == 'technical' %} <span
                                                        title="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ">üìê</span>
                                                    {% elif section == 'accounting' %} <span
                                                        title="–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è">üí∞</span>
                                                    {% elif section == 'safety' %} <span title="–û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞">üë∑</span>
                                                    {% elif section == 'legal' %} <span title="–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π">‚öñÔ∏è</span>
                                                    {% elif section == 'hr' %} <span title="–ö–∞–¥—Ä—ã">üëî</span>
                                                    {% endif %}
                                                </span>
                                                {% endfor %}
                                                {% else %}
                                                <span class="text-xs text-gray-400">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–¥–µ–ª–∞–º</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                                    {% if (object.created_by == user.id or user.role == "admin") and
                                    access.role.value
                                    != 'owner' %}
                                    <div class="flex flex-col gap-2 ml-4">
                                        <!-- –°–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ -->
                                        <div id="access-data-{{ access.user.id }}" style="display:none;">
                                            {{ access.sections_access|tojson }}
                                        </div>

                                        <button type="button" data-user-id="{{ access.user.id }}"
                                            data-role="{{ access.role.value }}" onclick="openEditAccessModal(this)"
                                            class="px-3 py-1 bg-indigo-600 text-white text-xs rounded-lg hover:bg-indigo-700 transition whitespace-nowrap">
                                            ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
                                        </button>
                                        <form method="post"
                                            action="/objects/{{ object.id }}/access/{{ access.user.id }}/revoke"
                                            onsubmit="return confirm('–û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø —É {{ access.user.first_name or access.user.email }}?');"
                                            style="display:inline;">
                                            <button type="submit"
                                                class="px-3 py-1 bg-red-600 text-white text-xs rounded-lg hover:bg-red-700 transition whitespace-nowrap">
                                                ‚úó –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </form>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <p class="text-center text-gray-500 py-4 text-sm">–¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü</p>
                            {% endif %}
                        </div>

                        <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—É–ª—É—á—à–µ–Ω–Ω–æ–µ) -->
                        <div id="addUserModal"
                            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div
                                class="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-xl font-bold text-gray-800">‚ûï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º</h3>
                                    <button onclick="document.getElementById('addUserModal').classList.add('hidden')"
                                        class="text-gray-500 hover:text-gray-700 text-2xl">
                                        √ó
                                    </button>
                                </div>


                                <!-- ‚úÖ –¢–ê–ë–´: –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å / –í–µ—Å—å –æ—Ç–¥–µ–ª -->
                                <div class="flex gap-2 mb-6 border-b">
                                    <button onclick="showAccessTab('user')" id="tab-user"
                                        class="px-4 py-2 font-medium border-b-2 border-indigo-600 text-indigo-600">
                                        üë§ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                    </button>
                                    <button onclick="showAccessTab('department')" id="tab-department"
                                        class="px-4 py-2 font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-800">
                                        üè¢ –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª
                                    </button>
                                </div>

                                <!-- ‚úÖ –§–û–†–ú–ê: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                                <div id="form-user" class="access-form">
                                    <form method="post" action="/objects/{{ object.id }}/access/grant"
                                        class="space-y-4">

                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">Email
                                                —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                                            <input type="email" name="user_email" id="userEmailInput" required
                                                list="userEmails"
                                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"
                                                placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å email...">

                                            <!-- ‚úÖ DATALIST –¥–ª—è –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞ -->
                                            <datalist id="userEmails">
                                                {% for u in all_users %}
                                                <option value="{{ u.email }}">{{ u.first_name }} {{ u.last_name }} -
                                                    {{
                                                    u.department or '–ë–µ–∑ –æ—Ç–¥–µ–ª–∞' }}</option>
                                                {% endfor %}
                                            </datalist>

                                            <p class="text-xs text-gray-500 mt-1">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å email ‚Äî –ø–æ—è–≤—è—Ç—Å—è
                                                –ø–æ–¥—Å–∫–∞–∑–∫–∏</p>
                                        </div>

                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">–†–æ–ª—å –¥–æ—Å—Ç—É–ø–∞</label>
                                            <select name="role" required
                                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                                <option value="viewer">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä (–º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –æ–±—ä–µ–∫—Ç –∏
                                                    –¥–æ–∫—É–º–µ–Ω—Ç—ã)
                                                </option>
                                                <option value="editor">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä (–º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç)
                                                </option>
                                                <option value="admin">üõ°Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É)
                                                </option>
                                            </select>
                                        </div>


                                        <!-- ‚úÖ –ì–ê–õ–û–ß–ö–ò: –î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–¥–µ–ª–∞–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">–î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–¥–µ–ª–∞–º
                                                –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</label>

                                            <div class="space-y-2 bg-gray-50 p-4 rounded-lg">

                                                <label class="flex items-center gap-2 cursor-pointer">
                                                    <input type="checkbox" name="sections" value="general" checked
                                                        disabled
                                                        class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                    <span class="text-gray-700">üìã –û–±—â–∏–µ <span
                                                            class="text-xs text-gray-500">(–≤—Å–µ–≥–¥–∞
                                                            –¥–æ—Å—Ç—É–ø–Ω–æ)</span></span>
                                                </label>

                                                <label class="flex items-center gap-2 cursor-pointer">
                                                    <input type="checkbox" name="sections" value="technical"
                                                        class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                    <span class="text-gray-700">üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</span>
                                                </label>

                                                <label class="flex items-center gap-2 cursor-pointer">
                                                    <input type="checkbox" name="sections" value="accounting"
                                                        class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                    <span class="text-gray-700">üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</span>
                                                </label>

                                                <label class="flex items-center gap-2 cursor-pointer">
                                                    <input type="checkbox" name="sections" value="safety"
                                                        class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                    <span class="text-gray-700">üë∑ –û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞</span>
                                                </label>

                                                <label class="flex items-center gap-2 cursor-pointer">
                                                    <input type="checkbox" name="sections" value="legal"
                                                        class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                    <span class="text-gray-700">‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ</span>
                                                </label>

                                                <label class="flex items-center gap-2 cursor-pointer">
                                                    <input type="checkbox" name="sections" value="hr"
                                                        class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                    <span class="text-gray-700">üëî –ö–∞–¥—Ä–æ–≤—ã–µ</span>
                                                </label>

                                            </div>

                                            <p class="text-xs text-gray-500 mt-2">
                                                üí° –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –æ—Ç–¥–µ–ª—É, —Ä–∞–∑–¥–µ–ª –µ–≥–æ –æ—Ç–¥–µ–ª–∞ –¥–æ–±–∞–≤–∏—Ç—Å—è
                                                –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                                            </p>
                                        </div>

                                        <div class="flex gap-4 pt-4">
                                            <button type="submit"
                                                class="flex-1 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                                ‚úì –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                            </button>
                                            <button type="button"
                                                onclick="document.getElementById('addUserModal').classList.add('hidden')"
                                                class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                                –û—Ç–º–µ–Ω–∞
                                            </button>
                                        </div>

                                    </form>
                                </div>


                                <!-- ‚úÖ –§–û–†–ú–ê: –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Å—å –æ—Ç–¥–µ–ª -->
                                <div id="form-department" class="access-form hidden">
                                    <form method="post" action="/objects/{{ object.id }}/access/grant-department"
                                        class="space-y-4">

                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ
                                                –æ—Ç–¥–µ–ª</label>
                                            <select name="department" required
                                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª</option>
                                                <option value="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª">üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª</option>
                                                <option value="–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è">üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</option>
                                                <option value="–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤">üëî –û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤</option>
                                                <option value="–û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞">üë∑ –û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞</option>
                                                <option value="–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π">‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π</option>
                                                <option value="–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π">üíº –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">–†–æ–ª—å –¥–æ—Å—Ç—É–ø–∞</label>
                                            <select name="role" required
                                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                                <option value="viewer">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä (–º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –æ–±—ä–µ–∫—Ç –∏
                                                    –¥–æ–∫—É–º–µ–Ω—Ç—ã)</option>
                                                <option value="editor">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä (–º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç –∏
                                                    –¥–æ–∫—É–º–µ–Ω—Ç—ã)</option>
                                                <option value="admin">üõ°Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)</option>
                                            </select>
                                        </div>

                                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                                            <p class="text-sm text-yellow-800">
                                                ‚ö†Ô∏è –í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –ø–æ–ª—É—á–∞—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É.<br>
                                                –†–∞–∑–¥–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏—Ö –æ—Ç–¥–µ–ª–∞ –¥–æ–±–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                                            </p>
                                        </div>

                                        <div class="flex gap-4 pt-4">
                                            <button type="submit"
                                                class="flex-1 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                                ‚úì –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª
                                            </button>
                                            <button type="button"
                                                onclick="document.getElementById('addUserModal').classList.add('hidden')"
                                                class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                                –û—Ç–º–µ–Ω–∞
                                            </button>
                                        </div>

                                    </form>
                                </div>

                            </div>
                        </div>


                        <!-- ‚úÖ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ -->
                        <div id="editAccessModal"
                            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full mx-4">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –¥–æ—Å—Ç—É–ø</h3>
                                    <button onclick="document.getElementById('editAccessModal').classList.add('hidden')"
                                        class="text-gray-500 hover:text-gray-700 text-2xl">
                                        √ó
                                    </button>
                                </div>

                                <form id="editAccessForm" method="post" action="" class="space-y-4">

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–†–æ–ª—å –¥–æ—Å—Ç—É–ø–∞</label>
                                        <select name="role" id="editRole" required
                                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-indigo-500">
                                            <option value="viewer">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä (–º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –æ–±—ä–µ–∫—Ç –∏
                                                –¥–æ–∫—É–º–µ–Ω—Ç—ã)</option>
                                            <option value="editor">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä (–º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç –∏
                                                –¥–æ–∫—É–º–µ–Ω—Ç—ã)</option>
                                            <option value="admin">üõ°Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)</option>
                                        </select>
                                    </div>

                                    <!-- ‚úÖ –ì–ê–õ–û–ß–ö–ò: –î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–¥–µ–ª–∞–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">–î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–¥–µ–ª–∞–º
                                            –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</label>

                                        <div class="space-y-2 bg-gray-50 p-4 rounded-lg">

                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="sections" value="general" checked disabled
                                                    class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                <span class="text-gray-700">üìã –û–±—â–∏–µ <span
                                                        class="text-xs text-gray-500">(–≤—Å–µ–≥–¥–∞)</span></span>
                                            </label>

                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="sections" value="technical"
                                                    id="edit-section-technical"
                                                    class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                <span class="text-gray-700">üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</span>
                                            </label>

                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="sections" value="accounting"
                                                    id="edit-section-accounting"
                                                    class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                <span class="text-gray-700">üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</span>
                                            </label>

                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="sections" value="safety"
                                                    id="edit-section-safety"
                                                    class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                <span class="text-gray-700">üë∑ –û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞</span>
                                            </label>

                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="sections" value="legal"
                                                    id="edit-section-legal"
                                                    class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                <span class="text-gray-700">‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ</span>
                                            </label>

                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="sections" value="hr" id="edit-section-hr"
                                                    class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-200">
                                                <span class="text-gray-700">üëî –ö–∞–¥—Ä–æ–≤—ã–µ</span>
                                            </label>

                                        </div>
                                    </div>

                                    <div class="flex gap-4 pt-4">
                                        <button type="submit"
                                            class="flex-1 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                            ‚úì –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                        </button>
                                        <button type="button"
                                            onclick="document.getElementById('editAccessModal').classList.add('hidden')"
                                            class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                            –û—Ç–º–µ–Ω–∞
                                        </button>
                                    </div>

                                </form>
                            </div>
                        </div>

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="bg-white rounded-xl shadow-md p-6 fade-in" style="animation-delay: 0.4s">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">–°–æ–∑–¥–∞–Ω:</span>
                                    <span class="text-gray-800">{{ object.created_at.strftime('%d.%m.%Y') }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">–û–±–Ω–æ–≤–ª–µ–Ω:</span>
                                    <span class="text-gray-800">{{ object.updated_at.strftime('%d.%m.%Y') }}</span>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

            </div>

        </main>

    </div>

    <!-- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <script>
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ
        const subcategoriesDataGeneral = {{ (subcategories_general | tojson | safe) if subcategories_general else "[]" }};
        const subcategoriesDataTechnical = {{ (subcategories_technical | tojson | safe) if subcategories_technical else "[]" }};
        const subcategoriesDataAccounting = {{ (subcategories_accounting | tojson | safe) if subcategories_accounting else "[]" }};
        const subcategoriesDataSafety = {{ (subcategories_safety | tojson | safe) if subcategories_safety else "[]" }};
        const subcategoriesDataLegal = {{ (subcategories_legal | tojson | safe) if subcategories_legal else "[]" }};
        const subcategoriesDataHr = {{ (subcategories_hr | tojson | safe) if subcategories_hr else "[]" }};

        console.log('‚úÖ subcategories_general:', subcategoriesDataGeneral);
        console.log('‚úÖ subcategories_technical:', subcategoriesDataTechnical);
        console.log('‚úÖ subcategories_accounting:', subcategoriesDataAccounting);
        console.log('‚úÖ subcategories_safety:', subcategoriesDataSafety);
        console.log('‚úÖ subcategories_legal:', subcategoriesDataLegal);
        console.log('‚úÖ subcategories_hr:', subcategoriesDataHr);

        document.addEventListener('DOMContentLoaded', function () {
            const subcategoriesData = {
                general: subcategoriesDataGeneral,
                technical: subcategoriesDataTechnical,
                accounting: subcategoriesDataAccounting,
                safety: subcategoriesDataSafety,
                legal: subcategoriesDataLegal,
                hr: subcategoriesDataHr,
            };

            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π:', subcategoriesData);
            if (typeof initializeSubcategories === 'function') {
                initializeSubcategories(subcategoriesData);
            } else {
                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è initializeSubcategories –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        });
    </script>


</body>

</html>