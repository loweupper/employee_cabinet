# –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –¥–ª—è –≤–∞—à–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏

## üéØ –ß—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç-–ø–æ–º–æ—â–Ω–∏–∫ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
docker ps

# 2. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è employees_app, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å:
./migrate.sh upgrade

# 3. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ-–¥—Ä—É–≥–æ–º—É, —É–∫–∞–∑–∞—Ç—å –∏–º—è:
export DOCKER_CONTAINER_NAME=–≤–∞—à–µ_–∏–º—è_–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
./migrate.sh upgrade

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
./migrate.sh current
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é

```bash
# 1. –£–∑–Ω–∞—Ç—å –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
docker ps

# –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:
# CONTAINER ID   IMAGE              NAMES
# abc123def456   employee_app       employees_app
# xyz789ghi012   postgres:15        employees_db

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ employees_app –Ω–∞ –≤–∞—à–µ –∏–º—è):
docker exec -it employees_app sh -c "cd /app && alembic upgrade head"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é:
docker exec -it employees_app sh -c "cd /app && alembic current"
```

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –£–∑–Ω–∞–π—Ç–µ –∏–º—è –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker ps
```

–ù–∞–π–¥–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≤–∞—à–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –ó–∞–ø–æ–º–Ω–∏—Ç–µ –µ–≥–æ –∏–º—è (–≤ –∫–æ–ª–æ–Ω–∫–µ NAMES).

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é (–í–ê–ñ–ù–û!)
```bash
# –ï—Å–ª–∏ –±–∞–∑–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
docker exec postgres_container_name pg_dump -U postgres -d employee_cabinet > backup_$(date +%Y%m%d).sql

# –ò–ª–∏ –µ—Å–ª–∏ –±–∞–∑–∞ –≤ —Ç–æ–º –∂–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
docker exec employees_app pg_dump -U postgres -d employee_cabinet > backup_$(date +%Y%m%d).sql
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–°–ø–æ—Å–æ–± A - –ò—Å–ø–æ–ª—å–∑—É—è —Å–∫—Ä–∏–ø—Ç:**
```bash
chmod +x migrate.sh
./migrate.sh upgrade
```

**–°–ø–æ—Å–æ–± B - –í—Ä—É—á–Ω—É—é:**
```bash
docker exec -it employees_app sh -c "cd /app && alembic upgrade head"
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```bash
# –° –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞:
./migrate.sh current

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
docker exec -it employees_app sh -c "cd /app && alembic current"
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
001 (head)
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
docker exec -it employees_app psql -U postgres -d employee_cabinet

# –í psql –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
SELECT * FROM departments;
SELECT id, email, department_id FROM users LIMIT 5;
\q
```

## üÜò –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞: "No such container"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏:
docker ps

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–Ω–æ–µ –∏–º—è –∏–∑ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã
docker exec -it –¢–û–ß–ù–û–ï_–ò–ú–Ø_–ö–û–ù–¢–ï–ô–ù–ï–†–ê sh -c "cd /app && alembic upgrade head"
```

### –û—à–∏–±–∫–∞: "Can't locate revision"
```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Alembic:
docker exec -it employees_app sh -c "cd /app && alembic stamp head"
docker exec -it employees_app sh -c "cd /app && alembic upgrade head"
```

### –û—à–∏–±–∫–∞: "Connection refused"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—â–µ–Ω–∞:
docker ps | grep postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
docker exec employees_app env | grep POSTGRES

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
docker-compose restart
```

### –û—à–∏–±–∫–∞: "Table already exists"
```bash
# –í–æ–∑–º–æ–∂–Ω–æ, –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
docker exec -it employees_app sh -c "cd /app && alembic current"

# –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 001 (head), –∑–Ω–∞—á–∏—Ç –≤—Å—ë —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ!
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
./migrate.sh current
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: 001 (head)

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É departments
docker exec -it employees_app psql -U postgres -d employee_cabinet -c "SELECT * FROM departments;"
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 6 –æ—Ç–¥–µ–ª–æ–≤

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å users -> departments
docker exec -it employees_app psql -U postgres -d employee_cabinet -c "SELECT COUNT(*) FROM users WHERE department_id IS NOT NULL;"
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ—Ç–¥–µ–ª–æ–º

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
docker-compose up -d
# –ó–∞–π—Ç–∏ –Ω–∞ http://localhost:8000/admin/users
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å dropdown —Å –æ—Ç–¥–µ–ª–∞–º–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

## üîÑ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```bash
./migrate.sh downgrade -1
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose down

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
docker-compose up -d db
docker exec -i postgres_container psql -U postgres -d employee_cabinet < backup_–î–ê–¢–ê.sql

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose up -d
```

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:
1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker logs employees_app`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [DOCKER_MIGRATION_GUIDE.md](./DOCKER_MIGRATION_GUIDE.md)
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./migrate.sh help` –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–¥–∞–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
docker ps -a

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs employees_app -f

# –ó–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec -it employees_app /bin/bash

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose restart

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d --build
```
